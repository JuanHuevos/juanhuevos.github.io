<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Verificaci√≥n: Cultivo Agr√≠cola</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 2rem;
            background: #1a1a2e;
            color: #e0e0e0;
        }

        .result {
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .success {
            background: #1e4d2b;
            border: 1px solid #4ade80;
        }

        .fail {
            background: #4d1e1e;
            border: 1px solid #f87171;
        }

        pre {
            background: #2a2a4e;
            padding: 1rem;
            border-radius: 4px;
            overflow-x: auto;
        }

        h1 {
            color: #fbbf24;
        }

        button {
            background: #3b82f6;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
        }

        button:hover {
            background: #2563eb;
        }
    </style>
</head>

<body>
    <h1>üåæ Verificaci√≥n: Cultivo Agr√≠cola</h1>
    <p>Esta prueba verifica que la f√≥rmula de producci√≥n sea correcta:</p>
    <pre>Producci√≥n = (Base √ó Cuotas) + ModAgr√≠cola + ModCalidad</pre>

    <h2>Configuraci√≥n de Prueba</h2>
    <ul>
        <li><strong>Trabajadores:</strong> 3 cuotas</li>
        <li><strong>Producci√≥n Base:</strong> 2 Alimento/cuota</li>
        <li><strong>Bonificaci√≥n Propiedad (Tierra F√©rtil):</strong> +1</li>
        <li><strong>Calidad Total:</strong> 10 ‚Üí ModCalidad = floor(10/5) = +2</li>
    </ul>
    <pre>Esperado: (2 √ó 3) + 1 + 2 = 9 Alimento</pre>

    <button onclick="ejecutarPrueba()">‚ñ∂Ô∏è Ejecutar Prueba</button>

    <div id="resultado"></div>

    <script src="js/data.js"></script>
    <script src="js/app.js"></script>
    <script src="js/simulation.js"></script>
    <script>
        function ejecutarPrueba() {
            const resultadoDiv = document.getElementById('resultado');

            try {
                // Reset simulation
                resetearSimulacion();

                // Configure mock settlement
                const asentamientoMock = {
                    grado: "Estamento",
                    tributo: "Sin Tributo",
                    propiedades: ["Tierra F√©rtil"], // +1 Producci√≥n Agr√≠cola
                    peculiaridades: [],
                    edificios: ["Cultivo Agr√≠cola"],
                    bonificacionesEventos: { "Calidad": 10 } // Force quality to 10
                };

                // Initialize state
                estadoSimulacion.almacen = {};
                estadoSimulacion.poblacion = [
                    { id: 1, medidas: 20, asignacion: "edificio:Cultivo Agr√≠cola" },
                    { id: 2, medidas: 20, asignacion: "edificio:Cultivo Agr√≠cola" },
                    { id: 3, medidas: 20, asignacion: "edificio:Cultivo Agr√≠cola" }
                ];

                // Run turn
                const result = ejecutarTurno(asentamientoMock);

                // Get produced food
                const alimentoProducido = estadoSimulacion.almacen["Alimento"] || 0;

                // Calculate stats to get actual quality value
                const stats = calcularEstadisticasTotales(asentamientoMock);
                const calidadReal = stats.calidadTotal || 0;
                const modCalidadReal = Math.floor(calidadReal / 5);

                // ModAgricola from Tierra F√©rtil = 1
                const modAgricola = stats.bonificaciones["Producci√≥n Agr√≠cola"] || 0;

                // Expected: (base * cuotas) + modAgricola + modCalidad
                const esperado = (2 * 3) + modAgricola + modCalidadReal;

                let html = `
                    <h2>Resultados</h2>
                    <ul>
                        <li><strong>Calidad Calculada:</strong> ${calidadReal}</li>
                        <li><strong>ModCalidad:</strong> floor(${calidadReal}/5) = ${modCalidadReal}</li>
                        <li><strong>ModAgr√≠cola:</strong> ${modAgricola}</li>
                        <li><strong>Producci√≥n Real:</strong> ${alimentoProducido} Alimento</li>
                        <li><strong>Producci√≥n Esperada:</strong> ${esperado} Alimento (6 base + ${modAgricola} prop + ${modCalidadReal} cal)</li>
                    </ul>
                `;

                if (alimentoProducido === esperado) {
                    html += `<div class="result success">‚úÖ <strong>√âXITO:</strong> La f√≥rmula se aplica correctamente.</div>`;
                } else {
                    html += `<div class="result fail">‚ùå <strong>FALLO:</strong> Diferencia de ${alimentoProducido - esperado} unidades.</div>`;
                }

                resultadoDiv.innerHTML = html;

            } catch (error) {
                resultadoDiv.innerHTML = `<div class="result fail">‚ùå <strong>ERROR:</strong> ${error.message}<br><pre>${error.stack}</pre></div>`;
            }
        }
    </script>
</body>

</html>